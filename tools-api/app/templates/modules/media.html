<section id="media-tools" class="panel">
    <header class="panel__header">
        <h2>Media Toolkit</h2>
        <p>Orchestrate yt-dlp downloads with streaming progress, subtitles, and stored assets.</p>
    </header>
    <div class="panel__body">
        <div class="panel__grid">
            <div class="panel__column">
                <div class="tool-grid">
                    <div class="card">
                        <form id="ffmpeg-convert-form" class="tool-form">
                            <div class="form-header">
                                <h3>FFmpeg Converter</h3>
                                <p class="muted">Upload any supported media, choose input and output formats, and we will transcode it with FFmpeg.</p>
                            </div>
                            <label for="ffmpeg-from-format">From</label>
                            <select id="ffmpeg-from-format">
                                <option value="">Auto detect</option>
                            </select>
                            <label for="ffmpeg-to-format">To</label>
                            <select id="ffmpeg-to-format" required></select>
                            <label for="ffmpeg-file">Media file</label>
                            <input id="ffmpeg-file" type="file" required />
                            <p id="ffmpeg-format-status" class="helper-text">Loading FFmpeg formats…</p>
                            <div class="form-actions">
                                <button type="button" class="text-btn" id="ffmpeg-refresh-formats">Refresh formats</button>
                                <button type="submit" class="primary-btn">Convert</button>
                            </div>
                        </form>
                    </div>
                    <div class="card">
                        <form id="yt-dlp-form" class="tool-form">
                            <div class="form-header">
                                <h3>Inspect &amp; Download</h3>
                                <p class="muted">Paste any supported URL to preview formats, fetch subtitles, or trigger a download job.</p>
                            </div>
                            <label for="yt-dlp-url">Media URL</label>
                            <input id="yt-dlp-url" type="url" required placeholder="https://www.youtube.com/watch?v=..." />

                            <div class="field-group">
                                <span class="field-label">Download type</span>
                                <div id="yt-dlp-mode-toggle" class="pill-toggle">
                                    <label class="pill-option">
                                        <input type="radio" name="yt-dlp-mode" value="video" checked />
                                        <span>Video</span>
                                    </label>
                                    <label class="pill-option">
                                        <input type="radio" name="yt-dlp-mode" value="audio" />
                                        <span>Audio</span>
                                    </label>
                                    <label class="pill-option">
                                        <input type="radio" name="yt-dlp-mode" value="subtitles" />
                                        <span>Subtitles</span>
                                    </label>
                                </div>
                                <p class="helper-text">Switch modes before downloading to tailor the controls below.</p>
                            </div>

                            <div id="yt-dlp-subtitle-controls" class="subtitle-controls" hidden>
                                <div class="field-row">
                                    <label class="radio">
                                        <input type="radio" name="yt-dlp-subtitle-source" value="original" checked />
                                        <span>Original subtitles</span>
                                    </label>
                                    <label class="radio">
                                        <input type="radio" name="yt-dlp-subtitle-source" value="auto" />
                                        <span>Auto translated</span>
                                    </label>
                                </div>
                                <label for="yt-dlp-subtitle-language-list">Languages</label>
                                <select id="yt-dlp-subtitle-language-list" multiple size="6"></select>
                                <p class="helper-text">Pick one or more subtitle tracks. Leave empty to use the first available option.</p>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="primary-btn">Preview media info</button>
                                <button type="button" id="yt-dlp-open-modal" class="secondary-btn" disabled>
                                    Choose download quality
                                </button>
                            </div>

                            <div id="yt-dlp-progress" class="download-progress" role="status" aria-live="polite" hidden>
                                <div class="download-progress__meta">
                                    <span id="yt-dlp-progress-label">Preparing download…</span>
                                    <span id="yt-dlp-progress-percent"></span>
                                </div>
                                <div class="download-progress__bar">
                                    <span id="yt-dlp-progress-indicator"></span>
                                </div>
                            </div>

                            <details class="advanced-options">
                                <summary>Advanced options</summary>
                                <div class="advanced-grid">
                                    <div>
                                        <label for="yt-dlp-format">Format selector</label>
                                        <input
                                            id="yt-dlp-format"
                                            type="text"
                                            placeholder="bestvideo+bestaudio/best"
                                        />
                                    </div>
                                    <div>
                                        <label for="yt-dlp-playlist-items">Playlist items (e.g. 1-3,5)</label>
                                        <input id="yt-dlp-playlist-items" type="text" placeholder="1-3,5" />
                                    </div>
                                    <div>
                                        <label for="yt-dlp-filename">Filename override</label>
                                        <input id="yt-dlp-filename" type="text" placeholder="custom.mp4" />
                                    </div>
                                    <div>
                                        <label for="yt-dlp-headers">HTTP headers (JSON object)</label>
                                        <textarea
                                            id="yt-dlp-headers"
                                            rows="3"
                                            placeholder='{"Cookie": "session=..."}'
                                        ></textarea>
                                    </div>
                                    <div>
                                        <label for="yt-dlp-proxy">Proxy URL</label>
                                        <input id="yt-dlp-proxy" type="text" placeholder="socks5://localhost:9050" />
                                    </div>
                                    <div class="form-row">
                                        <label class="checkbox">
                                            <input id="yt-dlp-write-subtitles" type="checkbox" />
                                            <span>Write subtitles to disk</span>
                                        </label>
                                        <label class="checkbox">
                                            <input id="yt-dlp-write-auto-sub" type="checkbox" />
                                            <span>Write automatic subs</span>
                                        </label>
                                    </div>
                                    <div>
                                        <label for="yt-dlp-subtitle-langs">Subtitle languages (comma separated)</label>
                                        <input id="yt-dlp-subtitle-langs" type="text" placeholder="en,es" />
                                    </div>
                                </div>
                            </details>
                        </form>
                    </div>
                </div>
            </div>
            <aside class="panel__column panel__column--results">
                <div class="results-header">
                    <h3>FFmpeg output</h3>
                    <p class="muted">Converted files and logs appear here.</p>
                </div>
                <div id="ffmpeg-results" class="result-panel" aria-live="polite"></div>
                <div class="results-header">
                    <h3>yt-dlp output</h3>
                    <p class="muted">Metadata, downloads, and subtitle previews appear here.</p>
                </div>
                <div id="media-results" class="result-panel" aria-live="polite"></div>
            </aside>
        </div>
    </div>
</section>
